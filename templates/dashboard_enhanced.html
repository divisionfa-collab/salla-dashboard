<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم المتقدمة - Salla Integration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #5e72e4;
            --success-color: #2dce89;
            --danger-color: #f5365c;
            --warning-color: #fb6340;
            --info-color: #11cdef;
            --dark-color: #172b4d;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            margin: 20px;
            padding: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border-right: 4px solid var(--primary-color);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--dark-color);
        }

        .stat-label {
            color: #8898aa;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 5px;
            animation: pulse 2s infinite;
        }

        .status-indicator.active {
            background: var(--success-color);
        }

        .status-indicator.inactive {
            background: var(--danger-color);
        }

        .status-indicator.warning {
            background: var(--warning-color);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(45, 206, 137, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(45, 206, 137, 0); }
            100% { box-shadow: 0 0 0 0 rgba(45, 206, 137, 0); }
        }

        .action-button {
            background: linear-gradient(135deg, var(--primary-color), #8965e0);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(94, 114, 228, 0.3);
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(94, 114, 228, 0.4);
        }

        .tab-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .nav-tabs .nav-link {
            color: #8898aa;
            border: none;
            padding: 12px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background: white;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 -3px 10px rgba(0, 0, 0, 0.05);
        }

        .alert-custom {
            border-radius: 10px;
            border: none;
            padding: 15px 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .table-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .table thead th {
            background: #f6f9fc;
            border: none;
            color: #8898aa;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
            padding: 15px;
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 1px solid #e9ecef;
            padding: 12px 15px;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(94, 114, 228, 0.25);
        }

        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }

        .loading-spinner.active {
            display: block;
        }

        .metric-chart {
            height: 300px;
            margin: 20px 0;
        }

        .log-entry {
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            background: #f8f9fa;
            border-right: 3px solid #dee2e6;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .log-entry.error {
            background: #fff5f5;
            border-color: var(--danger-color);
        }

        .log-entry.warning {
            background: #fffaf0;
            border-color: var(--warning-color);
        }

        .log-entry.success {
            background: #f0fff4;
            border-color: var(--success-color);
        }

        .refresh-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            box-shadow: 0 5px 20px rgba(94, 114, 228, 0.4);
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            transform: rotate(180deg);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }

        .progress-custom {
            height: 8px;
            border-radius: 10px;
            overflow: hidden;
            background: #e9ecef;
        }

        .progress-bar-animated {
            background: linear-gradient(90deg, var(--primary-color), var(--info-color));
            animation: progress-animation 2s ease-in-out infinite;
        }

        @keyframes progress-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div class="loading-spinner">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">جاري التحميل...</span>
        </div>
    </div>

    <div class="main-container">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="display-4 fw-bold text-center mb-4">
                    <i class="bi bi-shop-window"></i> لوحة التحكم المتقدمة
                </h1>
                <div class="text-center">
                    <span class="badge bg-primary">Salla Integration v2.0</span>
                    <span class="badge bg-info ms-2" id="environment-badge">Development</span>
                    <span class="badge bg-success ms-2">
                        <i class="bi bi-wifi"></i> متصل
                        <span class="status-indicator active"></span>
                    </span>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stat-value" id="api-calls-count">0</div>
                            <div class="stat-label">استدعاءات API اليوم</div>
                        </div>
                        <div class="text-primary">
                            <i class="bi bi-graph-up" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                    <div class="progress progress-custom mt-3">
                        <div class="progress-bar progress-bar-animated" style="width: 75%"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stat-value" id="error-count">0</div>
                            <div class="stat-label">أخطاء اليوم</div>
                        </div>
                        <div class="text-danger">
                            <i class="bi bi-exclamation-triangle" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                    <div class="progress progress-custom mt-3">
                        <div class="progress-bar bg-danger" id="error-progress" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stat-value" id="response-time">0ms</div>
                            <div class="stat-label">متوسط وقت الاستجابة</div>
                        </div>
                        <div class="text-info">
                            <i class="bi bi-speedometer2" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                    <div class="progress progress-custom mt-3">
                        <div class="progress-bar bg-info" id="response-progress" style="width: 30%"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="stat-value" id="success-rate">100%</div>
                            <div class="stat-label">معدل النجاح</div>
                        </div>
                        <div class="text-success">
                            <i class="bi bi-check-circle" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                    <div class="progress progress-custom mt-3">
                        <div class="progress-bar bg-success" id="success-progress" style="width: 100%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Alert -->
        <div id="status-alert" class="alert alert-custom alert-info d-none" role="alert">
            <i class="bi bi-info-circle-fill me-2"></i>
            <span id="status-message"></span>
        </div>

        <!-- Main Tabs -->
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button">
                    <i class="bi bi-speedometer2"></i> لوحة القيادة
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="products-tab" data-bs-toggle="tab" data-bs-target="#products" type="button">
                    <i class="bi bi-box-seam"></i> المنتجات
                    <span class="notification-badge d-none" id="products-badge">0</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="monitoring-tab" data-bs-toggle="tab" data-bs-target="#monitoring" type="button">
                    <i class="bi bi-activity"></i> المراقبة
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="errors-tab" data-bs-toggle="tab" data-bs-target="#errors" type="button">
                    <i class="bi bi-bug"></i> الأخطاء
                    <span class="notification-badge d-none" id="errors-badge">0</span>
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="webhooks-tab" data-bs-toggle="tab" data-bs-target="#webhooks" type="button">
                    <i class="bi bi-webhook"></i> Webhooks
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button">
                    <i class="bi bi-gear"></i> الإعدادات
                </button>
            </li>
        </ul>

        <div class="tab-content" id="mainTabContent">
            <!-- Dashboard Tab -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                <div class="row">
                    <div class="col-md-8">
                        <h4 class="mb-3"><i class="bi bi-graph-up-arrow"></i> نظرة عامة على النظام</h4>
                        <div id="system-overview" class="table-container">
                            <table class="table table-hover">
                                <tbody id="system-status-table">
                                    <tr>
                                        <td><i class="bi bi-shield-check text-success"></i> حالة المصادقة</td>
                                        <td><span id="auth-status" class="badge bg-secondary">جاري التحقق...</span></td>
                                    </tr>
                                    <tr>
                                        <td><i class="bi bi-shop text-primary"></i> المتجر المتصل</td>
                                        <td><span id="store-name">غير متصل</span></td>
                                    </tr>
                                    <tr>
                                        <td><i class="bi bi-clock-history text-info"></i> آخر تحديث للتوكن</td>
                                        <td><span id="token-updated">-</span></td>
                                    </tr>
                                    <tr>
                                        <td><i class="bi bi-arrow-repeat text-warning"></i> عدد التحديثات</td>
                                        <td><span id="refresh-count">0</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="mt-4">
                            <h5><i class="bi bi-lightning"></i> الإجراءات السريعة</h5>
                            <div class="d-flex gap-2 flex-wrap mt-3">
                                <button class="btn action-button" onclick="connectStore()">
                                    <i class="bi bi-link-45deg"></i> ربط متجر جديد
                                </button>
                                <button class="btn action-button" onclick="refreshToken()">
                                    <i class="bi bi-arrow-clockwise"></i> تحديث التوكن
                                </button>
                                <button class="btn action-button" onclick="testConnection()">
                                    <i class="bi bi-wifi"></i> اختبار الاتصال
                                </button>
                                <button class="btn btn-outline-danger" onclick="clearLogs()">
                                    <i class="bi bi-trash"></i> مسح السجلات
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h4 class="mb-3"><i class="bi bi-clock-history"></i> آخر الأنشطة</h4>
                        <div id="recent-activities" class="table-container" style="max-height: 400px; overflow-y: auto;">
                            <!-- سيتم ملؤها بواسطة JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Tab -->
            <div class="tab-pane fade" id="products" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4><i class="bi bi-box-seam"></i> إدارة المنتجات</h4>
                    <div>
                        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addProductModal">
                            <i class="bi bi-plus-circle"></i> إضافة منتج
                        </button>
                        <button class="btn btn-primary ms-2" onclick="loadProducts()">
                            <i class="bi bi-arrow-clockwise"></i> تحديث
                        </button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="row mb-3">
                    <div class="col-md-3">
                        <select class="form-select" id="product-status-filter">
                            <option value="">جميع الحالات</option>
                            <option value="available">متوفر</option>
                            <option value="out_of_stock">نفذ المخزون</option>
                            <option value="hidden">مخفي</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="product-sort">
                            <option value="created_at">تاريخ الإنشاء</option>
                            <option value="name">الاسم</option>
                            <option value="price">السعر</option>
                            <option value="quantity">الكمية</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control" id="product-search" placeholder="بحث...">
                    </div>
                </div>

                <div id="products-container" class="table-container">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">جاري التحميل...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monitoring Tab -->
            <div class="tab-pane fade" id="monitoring" role="tabpanel">
                <h4 class="mb-3"><i class="bi bi-activity"></i> مراقبة الأداء</h4>
                
                <div class="row mb-3">
                    <div class="col-md-4">
                        <select class="form-select" id="metrics-period">
                            <option value="1h">آخر ساعة</option>
                            <option value="24h" selected>آخر 24 ساعة</option>
                            <option value="7d">آخر 7 أيام</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-primary" onclick="loadMetrics()">
                            <i class="bi bi-arrow-clockwise"></i> تحديث المقاييس
                        </button>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="table-container">
                            <h5><i class="bi bi-speedometer"></i> أداء النقاط النهائية</h5>
                            <canvas id="performance-chart" class="metric-chart"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="table-container">
                            <h5><i class="bi bi-pie-chart"></i> توزيع الاستدعاءات</h5>
                            <canvas id="calls-chart" class="metric-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <h5><i class="bi bi-table"></i> تفاصيل الأداء</h5>
                    <div id="performance-details" class="table-container">
                        <!-- سيتم ملؤها بواسطة JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Errors Tab -->
            <div class="tab-pane fade" id="errors" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4><i class="bi bi-bug"></i> سجل الأخطاء</h4>
                    <div>
                        <select class="form-select d-inline-block w-auto" id="error-severity">
                            <option value="">جميع المستويات</option>
                            <option value="LOW">منخفض</option>
                            <option value="MEDIUM">متوسط</option>
                            <option value="HIGH">عالي</option>
                            <option value="CRITICAL">حرج</option>
                        </select>
                        <button class="btn btn-primary ms-2" onclick="loadErrors()">
                            <i class="bi bi-arrow-clockwise"></i> تحديث
                        </button>
                    </div>
                </div>

                <div id="errors-container" class="table-container" style="max-height: 600px; overflow-y: auto;">
                    <!-- سيتم ملؤها بواسطة JavaScript -->
                </div>
            </div>

            <!-- Webhooks Tab -->
            <div class="tab-pane fade" id="webhooks" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4><i class="bi bi-webhook"></i> سجل Webhooks</h4>
                    <div>
                        <input type="text" class="form-control d-inline-block w-auto" id="webhook-filter" placeholder="فلترة حسب الحدث...">
                        <button class="btn btn-primary ms-2" onclick="loadWebhooks()">
                            <i class="bi bi-arrow-clockwise"></i> تحديث
                        </button>
                    </div>
                </div>

                <div id="webhooks-container" class="table-container">
                    <!-- سيتم ملؤها بواسطة JavaScript -->
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-pane fade" id="settings" role="tabpanel">
                <h4 class="mb-3"><i class="bi bi-gear"></i> الإعدادات</h4>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="table-container">
                            <h5><i class="bi bi-key"></i> بيانات الاعتماد</h5>
                            <table class="table">
                                <tbody>
                                    <tr>
                                        <td>Client ID</td>
                                        <td><span id="client-id-status" class="badge">جاري التحقق...</span></td>
                                    </tr>
                                    <tr>
                                        <td>Client Secret</td>
                                        <td><span id="client-secret-status" class="badge">جاري التحقق...</span></td>
                                    </tr>
                                    <tr>
                                        <td>Webhook Secret</td>
                                        <td><span id="webhook-secret-status" class="badge">جاري التحقق...</span></td>
                                    </tr>
                                    <tr>
                                        <td>Redirect URI</td>
                                        <td><code id="redirect-uri">-</code></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="table-container">
                            <h5><i class="bi bi-sliders"></i> خيارات النظام</h5>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="auto-refresh">
                                <label class="form-check-label" for="auto-refresh">
                                    تحديث تلقائي كل 30 ثانية
                                </label>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="debug-mode">
                                <label class="form-check-label" for="debug-mode">
                                    وضع التصحيح (Debug Mode)
                                </label>
                            </div>
                            <div class="form-check form-switch mb-3">
                                <input class="form-check-input" type="checkbox" id="notifications">
                                <label class="form-check-label" for="notifications">
                                    تفعيل الإشعارات
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <h5><i class="bi bi-database"></i> إدارة البيانات</h5>
                    <div class="d-flex gap-2 flex-wrap">
                        <button class="btn btn-warning" onclick="exportData()">
                            <i class="bi bi-download"></i> تصدير البيانات
                        </button>
                        <button class="btn btn-info" onclick="backupDatabase()">
                            <i class="bi bi-cloud-arrow-up"></i> نسخ احتياطي
                        </button>
                        <button class="btn btn-danger" onclick="if(confirm('هل أنت متأكد؟')) resetDatabase()">
                            <i class="bi bi-arrow-counterclockwise"></i> إعادة تعيين
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Refresh Button -->
    <button class="refresh-btn" onclick="refreshAll()" title="تحديث الكل">
        <i class="bi bi-arrow-clockwise"></i>
    </button>

    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-plus-circle"></i> إضافة منتج جديد</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="add-product-form">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">اسم المنتج *</label>
                                <input type="text" class="form-control" id="product-name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">السعر *</label>
                                <input type="number" class="form-control" id="product-price" step="0.01" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">الكمية</label>
                                <input type="number" class="form-control" id="product-quantity" value="0">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">SKU</label>
                                <input type="text" class="form-control" id="product-sku">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">الوصف</label>
                            <textarea class="form-control" id="product-description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">رابط الصورة</label>
                            <input type="url" class="form-control" id="product-image">
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">نوع المنتج</label>
                                <select class="form-select" id="product-type">
                                    <option value="physical">منتج فيزيائي</option>
                                    <option value="digital">منتج رقمي</option>
                                    <option value="service">خدمة</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">الحالة</label>
                                <select class="form-select" id="product-status">
                                    <option value="available">متوفر</option>
                                    <option value="out_of_stock">نفذ المخزون</option>
                                    <option value="hidden">مخفي</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" onclick="addProduct()">
                        <i class="bi bi-save"></i> حفظ المنتج
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/enhanced_main.js"></script>
</body>
</html>